#!/usr/bin/perl

use strict;
use Encode;
use File::Basename;
use File::Find;
use Foundation;

##
#  globals
my $debug = scalar(@ARGV) == 2 ; 
my $daemon      = '/Library/LaunchDaemons/com.apple.macbe.setSystemSleep.plist';

##
# subs
sub println
{
	for ( my $i = 0 ; $i < scalar(@_) ; $i++ ) {
		print($_[$i]);
	}
	print "\n";
}

sub cleanUp() {
    println("Cleaning up");
    if ( !$debug ) {
    	unlink $daemon || warn "could not unlink $daemon";
    	unlink $0      || warn "could not unlink $0";
    } else {
    	println("Would have removed $daemon and $0"); 
    }
}

##
# main program
if ( scalar(@ARGV) >= 2 ) {
	my $command  = $ARGV[0] ;
	my $argument = $ARGV[1] ;
	
	println("script $0");
	println("command = '$command'");
	println("argument = '$argument'");
	println("debug = $debug");

	my $K = "/usr/sbin/systemsetup '$command' '$argument'";
	println("K = $K");
	
	my $error   = system($K);
	println("error = $error");

	cleanUp() if (!$error) ;
} else {
	println('usage: setSystemSetup <command> <parameter> <do-not-debug>')
}

################################################################################
# always
exit 0;

# That's all Folks!
##
